<!DOCTYPE html>
<html lang="en" class="dark">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AI Code Review & Rewrite Agent</title>
    <meta name="description"
        content="AI-powered code review, rewriting, visualization and explanation tool using Groq Llama 3.3 70B." />

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        dark: { 900: '#0a0a0f', 800: '#12121a', 700: '#1a1a2e', 600: '#232340', 500: '#2d2d50' },
                        light: { 50: '#f8fafc', 100: '#f0f2f5', 200: '#e2e6ea', 300: '#d0d5dc', 700: '#374151' },
                        accent: { blue: '#6366f1', purple: '#8b5cf6', cyan: '#06b6d4', pink: '#ec4899', green: '#10b981', orange: '#f59e0b', red: '#ef4444' }
                    },
                    fontFamily: { sans: ['Inter', 'system-ui', 'sans-serif'], mono: ['JetBrains Mono', 'Fira Code', 'monospace'] }
                }
            }
        }
    </script>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=JetBrains+Mono:wght@400;500;600&display=swap"
        rel="stylesheet" />

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" />

    <!-- Highlight.js -->
    <link rel="stylesheet" id="hljs-theme"
        href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>

    <!-- Marked.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/11.1.1/marked.min.js"></script>

    <!-- D3.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>

    <!-- Custom Styles -->
    <link rel="stylesheet" href="/static/css/styles.css" />
</head>

<body class="bg-dark-900 text-gray-100 font-sans min-h-screen transition-colors duration-300">

    <!-- Animated Background (dark mode only) -->
    <div id="animBg" class="fixed inset-0 overflow-hidden pointer-events-none z-0">
        <div class="bg-orb bg-orb-1"></div>
        <div class="bg-orb bg-orb-2"></div>
        <div class="bg-orb bg-orb-3"></div>
        <div class="grid-bg"></div>
    </div>

    <!-- Main Container -->
    <div class="relative z-10 min-h-screen flex flex-col">

        <!-- ═══════════ HEADER ═══════════ -->
        <header class="header-bar border-b">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 py-3 flex items-center justify-between">
                <div class="flex items-center gap-3">
                    <div class="relative">
                        <div
                            class="w-10 h-10 rounded-xl bg-gradient-to-br from-accent-blue to-accent-purple flex items-center justify-center text-white text-xl shadow-lg shadow-accent-blue/25">
                            <i class="fa-solid fa-robot"></i>
                        </div>
                        <div
                            class="absolute -top-1 -right-1 w-3 h-3 bg-accent-green rounded-full border-2 border-dark-900 dark-border animate-pulse">
                        </div>
                    </div>
                    <div>
                        <h1
                            class="text-lg sm:text-xl font-bold bg-gradient-to-r from-white via-gray-200 to-gray-400 dark:bg-clip-text dark:text-transparent header-title">
                            AI Code Review & Rewrite Agent
                        </h1>
                        <p class="text-xs text-gray-500 font-medium">Powered by Groq • Llama 3.3 70B</p>
                    </div>
                </div>
                <div class="flex items-center gap-2 sm:gap-3">
                    <!-- Dark/Light Toggle -->
                    <button onclick="toggleTheme()" id="themeToggle"
                        class="w-9 h-9 rounded-xl flex items-center justify-center theme-toggle-btn transition-all"
                        title="Toggle dark/light mode">
                        <i class="fa-solid fa-moon" id="themeIcon"></i>
                    </button>
                    <span
                        class="hidden sm:flex px-3 py-1 rounded-full bg-accent-green/10 text-accent-green text-xs font-semibold border border-accent-green/20 items-center gap-1.5">
                        <span class="w-1.5 h-1.5 bg-accent-green rounded-full animate-pulse"></span> Online
                    </span>
                </div>
            </div>
        </header>

        <!-- ═══════════ MAIN ═══════════ -->
        <main class="flex-1 max-w-7xl mx-auto w-full px-4 sm:px-6 py-5">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-5 h-full">

                <!-- ═══════════ LEFT PANEL: INPUT ═══════════ -->
                <div class="flex flex-col gap-4">

                    <!-- Language & Options -->
                    <div class="glass-card p-4 rounded-2xl">
                        <div class="flex flex-wrap items-center gap-3">
                            <div class="flex items-center gap-2 flex-1 min-w-[180px]">
                                <label
                                    class="text-xs font-semibold text-label uppercase tracking-wider whitespace-nowrap">
                                    <i class="fa-solid fa-code mr-1"></i> Language
                                </label>
                                <select id="languageSelect" class="input-field flex-1 text-sm">
                                    <option value="python">Python</option>
                                    <option value="javascript">JavaScript</option>
                                    <option value="java">Java</option>
                                    <option value="cpp">C++</option>
                                    <option value="csharp">C#</option>
                                    <option value="go">Go</option>
                                    <option value="rust">Rust</option>
                                    <option value="typescript">TypeScript</option>
                                    <option value="php">PHP</option>
                                    <option value="ruby">Ruby</option>
                                    <option value="swift">Swift</option>
                                    <option value="kotlin">Kotlin</option>
                                </select>
                            </div>
                        </div>
                        <div class="mt-3 flex flex-wrap gap-2">
                            <span
                                class="text-xs font-semibold text-label uppercase tracking-wider mr-1 self-center">Focus:</span>
                            <label class="focus-chip"><input type="checkbox" value="bugs" class="focus-checkbox"
                                    checked /><span><i class="fa-solid fa-bug mr-1"></i>Bugs</span></label>
                            <label class="focus-chip"><input type="checkbox" value="performance" class="focus-checkbox"
                                    checked /><span><i
                                        class="fa-solid fa-gauge-high mr-1"></i>Performance</span></label>
                            <label class="focus-chip"><input type="checkbox" value="security" class="focus-checkbox"
                                    checked /><span><i
                                        class="fa-solid fa-shield-halved mr-1"></i>Security</span></label>
                            <label class="focus-chip"><input type="checkbox" value="best practices"
                                    class="focus-checkbox" checked /><span><i class="fa-solid fa-star mr-1"></i>Best
                                    Practices</span></label>
                        </div>
                    </div>

                    <!-- Code Editor -->
                    <div class="glass-card rounded-2xl flex-1 flex flex-col overflow-hidden">
                        <div class="flex items-center justify-between px-4 py-2.5 border-b editor-toolbar">
                            <div class="flex items-center gap-2">
                                <div class="flex gap-1.5">
                                    <span class="w-3 h-3 rounded-full bg-red-500/80"></span>
                                    <span class="w-3 h-3 rounded-full bg-yellow-500/80"></span>
                                    <span class="w-3 h-3 rounded-full bg-green-500/80"></span>
                                </div>
                                <span class="text-xs text-muted font-medium ml-2">Source Code</span>
                            </div>
                            <div class="flex items-center gap-1">
                                <button onclick="loadSample()" class="toolbar-btn" title="Load sample code"><i
                                        class="fa-solid fa-flask mr-1"></i>Sample</button>
                                <button onclick="clearCode()" class="toolbar-btn" title="Clear"><i
                                        class="fa-solid fa-trash mr-1"></i>Clear</button>
                            </div>
                        </div>
                        <textarea id="codeInput"
                            class="flex-1 bg-transparent font-mono text-sm p-4 resize-none outline-none min-h-[250px] lg:min-h-0 code-textarea"
                            placeholder="// Paste your code here...&#10;// Select a language and click an action below&#10;&#10;def example():&#10;    pass"
                            spellcheck="false"></textarea>
                    </div>

                    <!-- Action Buttons -->
                    <div class="grid grid-cols-2 sm:grid-cols-4 gap-2.5">
                        <button onclick="reviewCode()" id="reviewBtn" class="action-btn action-btn-review">
                            <i class="fa-solid fa-magnifying-glass-chart"></i><span>Review</span>
                        </button>
                        <button onclick="rewriteCode()" id="rewriteBtn" class="action-btn action-btn-rewrite">
                            <i class="fa-solid fa-wand-magic-sparkles"></i><span>Rewrite</span>
                        </button>
                        <button onclick="visualizeCode()" id="visualizeBtn" class="action-btn action-btn-visualize">
                            <i class="fa-solid fa-diagram-project"></i><span>Visualize</span>
                        </button>
                        <button onclick="explainCode()" id="explainBtn" class="action-btn action-btn-explain">
                            <i class="fa-solid fa-graduation-cap"></i><span>Explain</span>
                        </button>
                    </div>
                </div>

                <!-- ═══════════ RIGHT PANEL: OUTPUT ═══════════ -->
                <div class="flex flex-col gap-4">

                    <!-- Quality Score Card -->
                    <div id="scoreCard" class="glass-card p-4 rounded-2xl hidden">
                        <div class="flex items-center gap-4">
                            <div class="relative w-20 h-20 flex-shrink-0">
                                <svg class="w-full h-full transform -rotate-90" viewBox="0 0 36 36">
                                    <path
                                        d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"
                                        fill="none" stroke="rgba(128,128,128,0.15)" stroke-width="3" />
                                    <path id="scoreArc"
                                        d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"
                                        fill="none" stroke="url(#scoreGradient)" stroke-width="3"
                                        stroke-dasharray="0, 100" stroke-linecap="round"
                                        class="transition-all duration-1000 ease-out" />
                                    <defs>
                                        <linearGradient id="scoreGradient" x1="0%" y1="0%" x2="100%" y2="0%">
                                            <stop offset="0%" stop-color="#6366f1" />
                                            <stop offset="100%" stop-color="#06b6d4" />
                                        </linearGradient>
                                    </defs>
                                </svg>
                                <div class="absolute inset-0 flex items-center justify-center">
                                    <span id="scoreValue" class="text-xl font-bold score-text">0</span>
                                </div>
                            </div>
                            <div class="flex-1">
                                <h3 class="text-sm font-semibold text-heading">Code Quality Score</h3>
                                <p id="scoreLabel" class="text-xs text-muted mt-0.5">Analyzing...</p>
                                <div id="severityPills" class="flex flex-wrap gap-1.5 mt-2"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Output Tabs + Content -->
                    <div class="glass-card rounded-2xl flex-1 flex flex-col overflow-hidden">
                        <div class="flex items-center border-b tab-bar overflow-x-auto">
                            <button onclick="switchTab('review')" id="tabReview" class="tab-btn tab-active"><i
                                    class="fa-solid fa-clipboard-check mr-1.5"></i>Review</button>
                            <button onclick="switchTab('rewrite')" id="tabRewrite" class="tab-btn"><i
                                    class="fa-solid fa-code-compare mr-1.5"></i>Rewrite</button>
                            <button onclick="switchTab('visualize')" id="tabVisualize" class="tab-btn"><i
                                    class="fa-solid fa-diagram-project mr-1.5"></i>Visualize</button>
                            <button onclick="switchTab('explain')" id="tabExplain" class="tab-btn"><i
                                    class="fa-solid fa-graduation-cap mr-1.5"></i>Explain</button>
                            <div class="flex-1"></div>
                            <div class="flex items-center gap-1 pr-2">
                                <button onclick="downloadOutput()" id="downloadBtn" class="toolbar-btn hidden"
                                    title="Download code"><i class="fa-solid fa-download mr-1"></i>Download</button>
                                <button onclick="copyOutput()" id="copyBtn" class="toolbar-btn hidden" title="Copy"><i
                                        class="fa-regular fa-copy mr-1"></i>Copy</button>
                            </div>
                        </div>

                        <div class="flex-1 overflow-auto custom-scrollbar">
                            <!-- Review -->
                            <div id="panelReview" class="tab-panel active p-5">
                                <div id="reviewPlaceholder" class="placeholder-state">
                                    <div class="text-5xl mb-4 opacity-20"><i
                                            class="fa-solid fa-magnifying-glass-chart"></i></div>
                                    <h3 class="text-lg font-semibold text-heading mb-1">Ready to Review</h3>
                                    <p class="text-sm text-muted max-w-xs">Paste code and click <strong
                                            class="text-accent-blue">Review</strong> for AI analysis</p>
                                </div>
                                <div id="reviewContent" class="prose-output hidden"></div>
                            </div>
                            <!-- Rewrite -->
                            <div id="panelRewrite" class="tab-panel p-5">
                                <div id="rewritePlaceholder" class="placeholder-state">
                                    <div class="text-5xl mb-4 opacity-20"><i
                                            class="fa-solid fa-wand-magic-sparkles"></i></div>
                                    <h3 class="text-lg font-semibold text-heading mb-1">Ready to Rewrite</h3>
                                    <p class="text-sm text-muted max-w-xs">Click <strong
                                            class="text-accent-purple">Rewrite</strong> for optimized code</p>
                                </div>
                                <div id="rewriteContent" class="prose-output hidden"></div>
                            </div>
                            <!-- Visualize -->
                            <div id="panelVisualize" class="tab-panel p-5">
                                <div id="visualizePlaceholder" class="placeholder-state">
                                    <div class="text-5xl mb-4 opacity-20"><i class="fa-solid fa-diagram-project"></i>
                                    </div>
                                    <h3 class="text-lg font-semibold text-heading mb-1">Ready to Visualize</h3>
                                    <p class="text-sm text-muted max-w-xs">Click <strong
                                            class="text-accent-cyan">Visualize</strong> for an interactive code flow
                                        graph</p>
                                </div>
                                <div id="visualizeContent" class="hidden">
                                    <div id="d3Graph" class="d3-container mb-4"></div>
                                    <div class="graph-legend mb-3"></div>
                                    <div id="vizSummary" class="prose-output"></div>
                                </div>
                            </div>
                            <!-- Explain -->
                            <div id="panelExplain" class="tab-panel p-5">
                                <div id="explainPlaceholder" class="placeholder-state">
                                    <div class="text-5xl mb-4 opacity-20"><i class="fa-solid fa-graduation-cap"></i>
                                    </div>
                                    <h3 class="text-lg font-semibold text-heading mb-1">Ready to Explain</h3>
                                    <p class="text-sm text-muted max-w-xs">Click <strong
                                            class="text-accent-green">Explain</strong> for a detailed code walkthrough
                                    </p>
                                </div>
                                <div id="explainContent" class="prose-output hidden"></div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </main>

        <footer class="border-t footer-border py-3 text-center text-xs text-muted">
            Built with <i class="fa-solid fa-heart text-accent-pink/60 mx-1"></i> using FastAPI & Groq — Llama 3.3 70B
        </footer>
    </div>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="fixed inset-0 z-50 flex items-center justify-center hidden loading-overlay">
        <div class="glass-card p-8 rounded-2xl text-center max-w-sm mx-4">
            <div class="loading-spinner mb-4"></div>
            <h3 id="loadingTitle" class="text-lg font-semibold text-heading mb-1">Analyzing...</h3>
            <p id="loadingSubtitle" class="text-sm text-muted">This usually takes 5-15 seconds</p>
        </div>
    </div>

    <!-- Toast -->
    <div id="toast" class="fixed bottom-6 right-6 z-50 hidden toast-container">
        <div class="glass-card px-4 py-3 rounded-xl flex items-center gap-2 border border-accent-green/30 shadow-lg">
            <i id="toastIcon" class="fa-solid fa-check-circle text-accent-green"></i>
            <span id="toastMessage" class="text-sm"></span>
        </div>
    </div>

    <script src="/static/js/app.js"></script>
</body>

</html>